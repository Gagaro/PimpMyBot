<!DOCTYPE html>
<html lang="en">
    <head>
        <title>{% if poll %}{{ poll.title }}{% else %}Strawpoll {{ poll_id }}{% endif %}</title>
        <!--[if lte IE 8]><script language="javascript" type="text/javascript" src="/static/bower_components/flot/excanvas.min.js"></script><![endif]-->
        <script src="/static/bower_components/flot/jquery.js"></script>
        <script src="/static/bower_components/flot/jquery.flot.js"></script>
        <script src="/static/bower_components/flot/jquery.flot.pie.js"></script>
        <style>
            body {
                background-color: #00FF00;
            }
        </style>
    </head>
    <body>
        <div id="chart" style="width: 600px; height: 300px">Loading...</div>
        <script>
            var updatePoll = function() {
                $.get('{{ url('strawpoll:ajax_detail', id=poll_id) }}').success(function (api_data) {

                    var data = [];
                    for (var i = 0; i < api_data.options.length; i++) {
                        data.push({label: api_data.options[i], data: api_data.votes[i]});
                    }

                    var labelFormatter = function (label, series) {
                        console.log(series);
                        return "<div style='font-size:12pt; text-align:center; padding:2px; color:black;'>" + label
                                + "<br/>"+ series.data[0][1] +" (" + Math.round(series.percent) + "%)</div>";
                    };

                    $("#chart").html('');

                    $.plot($("#chart"), data, {
                        series: {
                            pie: {
                                show: true,
                                radius: 1,
                                label: {
                                    show: true,
                                    radius: 2 / 3,
                                    formatter: labelFormatter,
                                    threshold: 0.1
                                }
                            }
                        },
                        legend: {
                            show: false
                        }
                    });

                    setTimeout(updatePoll, 3000);
                });
            };

            updatePoll();
        </script>
    </body>
</html>